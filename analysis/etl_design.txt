1. Dimension Load Logic
    1.1 Patient Dimension (dim_patient)
        The patient dimension is populated from the source patients table.
        Each patient record is assigned a surrogate key that uniquely identifies the patient in the data warehouse, 
        independent of the source system.

        Natural identifiers such as patient ID and medical record number are preserved for traceability.
        Derived attributes, such as age group, are calculated during the load to support analytical use cases.

        Age groups are assigned based on the patient’s age at the time of load:

        Pediatric (0–18)

        Adult (19–65)

        Senior (65+)

        The dimension is refreshed by inserting new patients and updating existing records based on defined business rules
        (e.g., overwrite or Slowly Changing Dimension handling).


    1.2 Date Dimension (dim_date)
        The date dimension is a static, pre-generated dimension populated once.

        It contains one record per calendar date within a defined range (e.g., 1900–2100).
        Each date is assigned a surrogate date key and enriched with calendar attributes such as:

        Year
        Month
        Quarter
        Day of week
        Holiday indicator

        This dimension is not refreshed during regular ETL cycles and serves as a shared reference for all date-related joins
        in fact and bridge tables.

    1.3 Other Dimensions

        (provider, specialty, department, encounter type, diagnosis, procedure)

        All remaining dimensions follow the same general pattern:
            Source tables provide natural business keys.
            Each unique business entity is assigned a surrogate key.
            Descriptive attributes are stored to support reporting and slicing.
            Dimension updates depend on business requirements:
            Some dimensions may be overwritten on change.
            Others may use Slowly Changing Dimension (SCD) logic to preserve history.


2. Fact Table Load Logic
    2.1 Encounter Fact Table (fact_encounters)
    The encounter fact table stores one row per healthcare encounter.
    During load:
        Each encounter is matched to all related dimensions using natural keys.
        Dimension surrogate keys are resolved and stored in the fact table.

        The fact table references:
        Patient
        Provider
        Specialty
        Department
        Encounter type
        Encounter and discharge dates (via the date dimension)

    2.2 Derived and Aggregated Metrics
        Several analytical measures are calculated during the fact load:
            Diagnosis count: number of diagnoses associated with the encounter
            Procedure count: number of procedures performed during the encounter
            Total allowed amount: aggregated billing value for the encounter
            Encounter duration: time between encounter start and discharge
            Readmission flag: indicates whether a patient had a qualifying inpatient encounter within 30 days in the same specialty
            These measures are precomputed to improve query performance and simplify reporting logic.

    2.3 Missing Data Handling
        Where source data is incomplete:
            Null numeric values are replaced with zero
            Missing references are handled using default or “unknown” dimension keys
            This ensures referential integrity and prevents analytical errors during aggregation.


3. Bridge Table Load Logic
    3.1 Encounter–Diagnosis Bridge (bridge_encounter_diagnoses)
        This bridge table resolves the many-to-many relationship between encounters and diagnoses.
        For each encounter:
            All associated diagnoses are identified
            Each diagnosis is linked to the encounter using surrogate keys
            Diagnosis sequence is preserved to maintain clinical ordering
            Duplicate encounter–diagnosis combinations are eliminated to ensure data integrity.

    3.2 Encounter–Procedure Bridge (bridge_encounter_procedures)
        This bridge table resolves the many-to-many relationship between encounters and procedures.
        For each encounter:
            All performed procedures are linked using surrogate keys
            The procedure date is captured using the date dimension
            This structure supports flexible analysis of procedures by encounter, time, and procedure type without inflating the fact table.


4. Refresh and Maintenance Strategy
    4.1 Full Refresh vs Incremental Load
        The current implementation performs a full refresh, truncating and reloading all tables.
        For production use, an incremental load strategy is recommended:
            Insert only new encounters
            Load only new diagnoses and procedures
            Update dimensions selectively using SCD logic where appropriate
            Load frequency is determined by business needs, with daily or weekly refreshes common in healthcare analytics.

    4.2 Late-Arriving Data Handling
            Late-arriving encounters and related records are handled through upsert logic:
            New records are inserted when they arrive
            Existing fact records are updated if new information impacts derived metrics
            Metrics such as readmission indicators and financial totals are recalculated as needed to maintain accuracy.